var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{d:()=>i,P:()=>r});var s=function(){function e(e,t){var s;if(this.id="",e?(this.id=e.id,this.status=e.status,this.value=e.value,this.code=e.code,this.score=e.score):(this.status="NOT_SET",this.value=null),this.codingScheme=null,t&&(this.codingScheme=t,this.id=t.id,"BASE"!==(null===(s=this.codingScheme)||void 0===s?void 0:s.sourceType)&&(this.status="SOURCE_MISSING")),!this.id)throw new RangeError}return e.prototype.deriveAndCode_changesMade=function(e){var t,s=this;if(["CODING_ERROR","DERIVE_ERROR","NO_CODING","CODING_INCOMPLETE","CODING_COMPLETE","NOT_SET","NOT_REACHED","DISPLAYED"].indexOf(this.status)>=0)return!1;if(this.codingScheme){if("BASE"===(null===(t=this.codingScheme)||void 0===t?void 0:t.sourceType))return this.code_changesMade();var r=[];if(this.codingScheme.deriveSources.forEach((function(t){var i=null;e.forEach((function(e){!i&&e.id===t&&s.codingScheme&&("CODING_COMPLETE"===e.status||"VALUE"===s.codingScheme.deriveSourceType&&["SOURCE_MISSING","DERIVE_ERROR","NOT_SET","NOT_REACHED","DISPLAYED"].indexOf(e.status)<0)&&(i={id:e.id,status:e.status,value:e.value,code:e.code,score:e.score})})),i&&r.push(i)})),this.codingScheme.deriveSources.length>0&&r.length===this.codingScheme.deriveSources.length){var i=[];if(r.forEach((function(e){s.codingScheme&&("VALUE"===s.codingScheme.deriveSourceType?i.push(e.value?e.value.toString():""):"CODE"===s.codingScheme.deriveSourceType?i.push(e.code?e.code:0):i.push(e.score?e.score:0))})),"DERIVE_CONCAT"===this.codingScheme.sourceType)return this.value=i.map((function(e){return e.toString()})).join(""),this.status="VALUE_DERIVED",this.code_changesMade(),!0;var o=0;return i.forEach((function(e){var t;"number"==typeof e?t=e:(t=Number.parseFloat(e),Number.isNaN(t)&&(s.status="DERIVE_ERROR")),"DERIVE_ERROR"!==s.status&&(o+=t)})),"DERIVE_ERROR"===this.status||(this.value=o.toString(),this.status="VALUE_DERIVED",this.code_changesMade()),!0}return"SOURCE_MISSING"!==this.status&&(this.status="SOURCE_MISSING",!0)}return this.status="NO_CODING",!0},e.prototype.code_changesMade=function(){var t,s=this,r=!1;if(this.codingScheme&&this.codingScheme.codes.length>0){var i=this.transformValue();if("string"==typeof i){var o=!1,a=0,c=0;null===(t=this.codingScheme)||void 0===t||t.codes.forEach((function(t){r||t.rules.forEach((function(n){if(!r){var u=s.checkValueForNumber();switch(n.method){case"ELSE":o=!0,a=t.id,c=t.score;break;case"IS_EMPTY":""===i&&(s.code=t.id,s.score=t.score,s.status="CODING_COMPLETE",r=!0);break;case"MATCH":e.getMatchStrings(n.parameters).indexOf(i)>=0&&(s.code=t.id,s.score=t.score,s.status="CODING_COMPLETE",r=!0);break;case"MATCH_REGEX":e.getMatchStrings(n.parameters).forEach((function(e){new RegExp(e).exec(i)&&(s.code=t.id,s.score=t.score,s.status="CODING_COMPLETE",r=!0)}));break;case"NUMERIC_LESS_THEN":"CODING_ERROR"===s.status?r=!0:u<Number.parseFloat(n.parameters[0])&&(s.code=t.id,s.score=t.score,s.status="CODING_COMPLETE",r=!0);break;case"NUMERIC_MAX":"CODING_ERROR"===s.status?r=!0:u<=Number.parseFloat(n.parameters[0])&&(s.code=t.id,s.score=t.score,s.status="CODING_COMPLETE",r=!0);break;case"NUMERIC_MORE_THEN":"CODING_ERROR"===s.status?r=!0:u>Number.parseFloat(n.parameters[0])&&(s.code=t.id,s.score=t.score,s.status="CODING_COMPLETE",r=!0);break;case"NUMERIC_MIN":"CODING_ERROR"===s.status?r=!0:u>=Number.parseFloat(n.parameters[0])&&(s.code=t.id,s.score=t.score,s.status="CODING_COMPLETE",r=!0);break;case"NUMERIC_RANGE":if("CODING_ERROR"===s.status)r=!0;else{var h=Number.parseFloat(n.parameters[0]),d=Number.parseFloat(n.parameters[1]);u>h&&u<=d&&(s.code=t.id,s.score=t.score,s.status="CODING_COMPLETE",r=!0)}}}}))})),r||(o?(this.code=a,this.score=c,this.status="CODING_COMPLETE",r=!0):(this.code=0,this.score=0,this.status="CODING_INCOMPLETE",r=!0))}}else"NO_CODING"!==this.status&&(this.status="NO_CODING",r=!0);return r},e.prototype.transformValue=function(){var e,t,s=this.value;return"string"==typeof s&&this.codingScheme&&((null===(e=this.codingScheme)||void 0===e?void 0:e.valueTransformations.indexOf("TO_UPPER"))>=0&&(s=s.toUpperCase()),(null===(t=this.codingScheme)||void 0===t?void 0:t.valueTransformations.indexOf("REMOVE_WHITE_SPACES"))>=0&&(s=s.trim())),s},e.getMatchStrings=function(e){var t=[];return e.forEach((function(e){t=t.concat(e.split("\n"))})),t},e.prototype.checkValueForNumber=function(){if("string"==typeof this.value){var e=this.value.replace(",","."),t=Number.parseFloat(e);return Number.isNaN(t)?(this.status="CODING_ERROR",0):t}return this.status="CODING_ERROR",0},e}(),r={"@context":"https://w3id.org/iqb/verona-modules","@type":"coder","@id":"iqb-auto-coder",name:{de:"IQB-Autocoder",en:"IQB Auto coder"},maintainer:{name:{de:"IQB - Institut zur Qualit√§tsentwicklung im Bildungswesen",en:"IQB - Institute for Educational Quality Improvement"},url:"https://www.iqb.hu-berlin.de",email:"iqb-tbadev@hu-berlin.de"},description:{de:"Dieser Coder verarbeitet die Definition nach Typ iqb@1.1",en:"This coder can process coding schemes of type iqb@1.1"},version:"0.2.0-alpha",apiVersion:"0.1.0",repository:{type:"git",url:"https://github.com/iqb-berlin/schemer-autocoder"}},i=function(){function e(e){this.changed=!1,this.sourceValues=e}return e.prototype.run=function(e){var t=this,r=[],i=[];this.sourceValues.forEach((function(t){var o=null;e.forEach((function(e){e.id===t.id&&(o=e)})),i.push(new s(t,o)),r.push(t.id)})),e.forEach((function(e){r.indexOf(e.id)<0&&i.push(new s(null,e))})),this.changed=!0;for(var o=0;this.changed&&o<1e3;)this.changed=!1,o+=1,i.forEach((function(e){e.deriveAndCode_changesMade(i)&&(t.changed=!0)}));return o>=1e3&&console.log("iteration cancelled"),i},e}(),o=t.d,a=t.P;export{o as AutoCoder,a as metadata};